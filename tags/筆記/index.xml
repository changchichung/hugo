<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
    <channel>
        <title>筆記 on MCの部落</title>
        <link>https://h.cowbay.org/tags/%E7%AD%86%E8%A8%98/</link>
        <description>Recent content in 筆記 on MCの部落</description>
        <generator>Hugo -- gohugo.io</generator>
        <language>en-us</language>
        <lastBuildDate>Wed, 04 Mar 2020 16:38:55 +0800</lastBuildDate><atom:link href="https://h.cowbay.org/tags/%E7%AD%86%E8%A8%98/index.xml" rel="self" type="application/rss+xml" /><item>
        <title>[筆記] 設定ubuntu 18.04 的NetworkManager config 不要更改 /etc/resolv.conf</title>
        <link>https://h.cowbay.org/p/%E7%AD%86%E8%A8%98-%E8%A8%AD%E5%AE%9Aubuntu-18.04-%E7%9A%84networkmanager-config-%E4%B8%8D%E8%A6%81%E6%9B%B4%E6%94%B9-/etc/resolv.conf/</link>
        <pubDate>Wed, 04 Mar 2020 16:38:55 +0800</pubDate>
        
        <guid>https://h.cowbay.org/p/%E7%AD%86%E8%A8%98-%E8%A8%AD%E5%AE%9Aubuntu-18.04-%E7%9A%84networkmanager-config-%E4%B8%8D%E8%A6%81%E6%9B%B4%E6%94%B9-/etc/resolv.conf/</guid>
        <description>&lt;img src="https://h.cowbay.org/images/post-default-17.jpg" alt="Featured image of post [筆記] 設定ubuntu 18.04 的NetworkManager config 不要更改 /etc/resolv.conf" /&gt;&lt;p&gt;ubuntu 18.04 的 DNS 設定很煩&lt;/p&gt;
&lt;p&gt;系統預設會用NetworkManager 去管理&lt;/p&gt;
&lt;p&gt;然後NetworkManager 又很「靈活」的許多種修改 /etc/resolv.conf 的方式&lt;/p&gt;
&lt;p&gt;之前都是很粗暴的停用 NetworkManager&lt;/p&gt;
&lt;p&gt;但是用筆電的user 又需要用 NetworkManager 來管理無線網路&lt;/p&gt;
&lt;p&gt;今天找了一下文件，讓NetworkManager 可以執行，卻不會去異動 /etc/resolv.conf&lt;/p&gt;
&lt;p&gt;主要參考這篇文件&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://developer.gnome.org/NetworkManager/stable/NetworkManager.conf.html&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://developer.gnome.org/NetworkManager/stable/NetworkManager.conf.html&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;看一下 dns/rc-manager 這兩個部份&lt;/p&gt;
&lt;p&gt;然後修改 /etc/NetworkManager/NetworkManager.conf&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;[main]
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;plugins=ifupdown,keyfile
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;dns=none
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;rc-manager=unmanaged
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;[ifupdown]
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;managed=false
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;[device]
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;wifi.scan-rand-mac-address=no
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;主要就加入第三行和第四行&lt;/p&gt;
&lt;p&gt;接著安裝 resolvconf 這個套件&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sudo apt install resolvconf
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;修改resolvconf 的config&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sudo vim /etc/resolvconf/resolv.conf.d/head
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;加入以下內容
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;nameserver 168.95.1.1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;nameserver 8.8.8.8
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;然後重新啟動 NetworkManager 還有 resolvconf 或者重新開機&lt;/p&gt;
&lt;p&gt;就可以用 resolvconf 來管理 /etc/resolv.conf&lt;/p&gt;
&lt;p&gt;不會再發生DNS 被改成 127.0.0.53 這種怪東西了&lt;/p&gt;</description>
        </item>
        <item>
        <title>[筆記] 用 proxmox &amp; Mellanox SFP 網卡土炮 10G LAB </title>
        <link>https://h.cowbay.org/p/%E7%AD%86%E8%A8%98-%E7%94%A8-proxmox-mellanox-sfp-%E7%B6%B2%E5%8D%A1%E5%9C%9F%E7%82%AE-10g-lab/</link>
        <pubDate>Fri, 30 Nov 2018 16:05:14 +0800</pubDate>
        
        <guid>https://h.cowbay.org/p/%E7%AD%86%E8%A8%98-%E7%94%A8-proxmox-mellanox-sfp-%E7%B6%B2%E5%8D%A1%E5%9C%9F%E7%82%AE-10g-lab/</guid>
        <description>&lt;p&gt;想做一個 10G 的 LAB 環境出來已經很久了。&lt;/p&gt;
&lt;p&gt;只是礙於10G RJ45的卡太貴了，然後光纖的種類又太複雜&lt;/p&gt;
&lt;p&gt;如果直接在淘寶購買，很怕會買錯(什麼LC/FC LC/LC 多模單模 單芯雙芯 SFP/SFP+ 又是什麼光模塊的一大堆規格)&lt;/p&gt;
&lt;p&gt;所以一直沒有付諸行動。&lt;/p&gt;
&lt;p&gt;硬體的工作很久沒碰了，剛好在蝦皮看到有個賣家在賣 mellanox 的X2網卡，以在台灣的價格來說，算很便宜的 (550)&lt;/p&gt;
&lt;p&gt;聊了一下，跟他請教了關於線材、光纖模塊的問題，回答也都很快很到位&lt;/p&gt;
&lt;p&gt;就直接下訂了兩張網卡、兩個光纖模塊、一條LC/LC 光纖線&lt;/p&gt;
&lt;p&gt;就是到貨有點久，等了兩個禮拜左右，一直到昨天東西才寄到&lt;/p&gt;
&lt;p&gt;今天就花了點時間測試一下&lt;/p&gt;
&lt;p&gt;先上個圖！&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://i.imgur.com/34MNFkW.png&#34;
	
	
	
	loading=&#34;lazy&#34;
	
		alt=&#34;10G LAB&#34;
	
	
&gt;&lt;/p&gt;
&lt;p&gt;簡單說，就是有兩台機器，分別安裝 proxmox (一台是新裝的，另一台是本來就在線上的LAB用機器)以及光纖網卡&lt;/p&gt;
&lt;p&gt;Mellanox 這張 X2 的卡， proxmox 5.1 / 5.2 可以直接抓到，所以不必另外安裝驅動程式&lt;/p&gt;
&lt;p&gt;硬體安裝很順利，不過軟體的設定就碰到點麻煩了，所以才想說作個筆記..&lt;/p&gt;
&lt;h3 id=&#34;strongfont-colorred必須作-vmbridge-才能指定這個網卡給vm用-fontstrong&#34;&gt;&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;必須作 vmbridge 才能指定這個網卡給VM用 &lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;&lt;/h3&gt;
&lt;p&gt;安裝好網卡，開機，透過proxmox的WEB界面設定好網卡的資料後，原本以為可以直接使用了&lt;/p&gt;
&lt;p&gt;但是proxmox 會提示需要重新開機才能變更設定&lt;/p&gt;
&lt;p&gt;可是重新開機後，我兩台怎麼都ping不到對方&lt;/p&gt;
&lt;p&gt;在這之前，我已經用兩台 ubuntu 18.04 client 測試過了，只要設定好IP就可以直接通&lt;/p&gt;
&lt;p&gt;所以在這邊碰到這個問題，我滿訝異的&lt;/p&gt;
&lt;p&gt;可是看網卡的燈號，明明就有亮起來，應該是正常的呀&lt;/p&gt;
&lt;p&gt;原來，在proxmox 中，新增了網卡，並不是直接就可以拿來用&lt;/p&gt;
&lt;p&gt;要先設定好 bridge ，然後才能起新的VM、指定新設定的 vmbridge 給這個新起的機器使用&lt;/p&gt;
&lt;h3 id=&#34;strongfont-colorreddisk-cache-type-要改fontstrong&#34;&gt;&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;Disk Cache type 要改&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;&lt;/h3&gt;
&lt;p&gt;設定了新的 vmbridge 之後，就可以在新VM的設定畫面中，指定網卡走這個界面出去&lt;/p&gt;
&lt;p&gt;可是這樣做出來的VM ，一直無法開機&lt;/p&gt;
&lt;p&gt;錯誤訊息如下&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kvm: -drive file=/zp/images/100/vm-100-disk-1.qcow2,if=none,id=drive-virtio0,format=qcow2,cache=none,aio=native,detect-zeroes=on: file system may not support O_DIRECT
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kvm: -drive file=/zp/images/100/vm-100-disk-1.qcow2,if=none,id=drive-virtio0,format=qcow2,cache=none,aio=native,detect-zeroes=on: Could not open &amp;#39;/zp/images/100/vm-100-disk-1.qcow2&amp;#39;: Invalid argument
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;TASK ERROR: start failed: command &amp;#39;/usr/bin/kvm -id 100 -name 123123 -chardev &amp;#39;socket,id=qmp,path=/var/run/qemu-server/100.qmp,server,nowait&amp;#39; -mon &amp;#39;chardev=qmp,mode=control&amp;#39; -pidfile /var/run/qemu-server/100.pid -daemonize -smbios &amp;#39;type=1,uuid=da27a9ea-fd55-4542-b2a7-8d5b09bf7611&amp;#39; -smp &amp;#39;2,sockets=1,cores=2,maxcpus=2&amp;#39; -nodefaults -boot &amp;#39;menu=on,strict=on,reboot-timeout=1000,splash=/usr/share/qemu-server/bootsplash.jpg&amp;#39; -vga std -vnc unix:/var/run/qemu-server/100.vnc,x509,password -cpu kvm64,+lahf_lm,+sep,+kvm_pv_unhalt,+kvm_pv_eoi,enforce -m 2048 -device &amp;#39;pci-bridge,id=pci.2,chassis_nr=2,bus=pci.0,addr=0x1f&amp;#39; -device &amp;#39;pci-bridge,id=pci.1,chassis_nr=1,bus=pci.0,addr=0x1e&amp;#39; -device &amp;#39;piix3-usb-uhci,id=uhci,bus=pci.0,addr=0x1.0x2&amp;#39; -device &amp;#39;usb-tablet,id=tablet,bus=uhci.0,port=1&amp;#39; -device &amp;#39;virtio-balloon-pci,id=balloon0,bus=pci.0,addr=0x3&amp;#39; -iscsi &amp;#39;initiator-name=iqn.1993-08.org.debian:01:b972d1ad783&amp;#39; -drive &amp;#39;file=/zp/template/iso/ubuntu-18.04.1-live-server-amd64.iso,if=none,id=drive-ide2,media=cdrom,aio=threads&amp;#39; -device &amp;#39;ide-cd,bus=ide.1,unit=0,drive=drive-ide2,id=ide2,bootindex=200&amp;#39; -drive &amp;#39;file=/zp/images/100/vm-100-disk-1.qcow2,if=none,id=drive-virtio0,format=qcow2,cache=none,aio=native,detect-zeroes=on&amp;#39; -device &amp;#39;virtio-blk-pci,drive=drive-virtio0,id=virtio0,bus=pci.0,addr=0xa,bootindex=100&amp;#39; -netdev &amp;#39;type=tap,id=net0,ifname=tap100i0,script=/var/lib/qemu-server/pve-bridge,downscript=/var/lib/qemu-server/pve-bridgedown,vhost=on&amp;#39; -device &amp;#39;virtio-net-pci,mac=A2:EA:45:EE:17:25,netdev=net0,bus=pci.0,addr=0x12,id=net0,bootindex=300&amp;#39;&amp;#39; failed: exit code 1
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;當然先去拜google，果然就看到了提示，需要把 磁碟的 Cache 從預設的 Default(No Cache) 改成 write through&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://i.imgur.com/cmClmGd.png&#34;
	
	
	
	loading=&#34;lazy&#34;
	
		alt=&#34;proxmox dish cache mode&#34;
	
	
&gt;&lt;/p&gt;
&lt;p&gt;為什麼？我也不知道..不知道是不是因為我把磁碟種類選成用 Virtio Block 的關係&lt;/p&gt;
&lt;p&gt;總之呢，改完之後就可以了 &amp;hellip;&lt;/p&gt;
&lt;h3 id=&#34;strongfont-colorred必須手動設定路由fontstrong&#34;&gt;&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;必須手動設定路由&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;&lt;/h3&gt;
&lt;h4 id=&#34;update&#34;&gt;Update&lt;/h4&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;這邊可能是我有誤解，應該不需要先在pve 本機設定 10G網卡的 IP
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;直接進web console 去設定 vmbr1 就好了
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;設定好新的VM，開機、設定IP、重開機之後，會發現還是ping 不到另一台機器..(翻桌！)&lt;/p&gt;
&lt;p&gt;只好又去拜google ，就看到了底下這篇&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://forum.proxmox.com/threads/how-to-add-second-nic.40905/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://forum.proxmox.com/threads/how-to-add-second-nic.40905/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;大概點出了方向，必須要手動增加路由(感覺有點蠢)&lt;/p&gt;
&lt;p&gt;像我的光纖網卡走的是 192.168.50.0/24 ，就要去把原有的192.168.50.0/24的路由給砍掉，然後再新增(是不是很蠢？)&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;8
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;root@ssd:/etc/network# ip route del 192.168.50.0/24
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;root@ssd:/etc/network# ip route add 192.168.50.0/24 dev vmbr1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;root@ssd:/etc/network# ip route
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;default via 192.168.11.253 dev vmbr0 onlink 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;192.168.11.0/24 dev vmbr0 proto kernel scope link src 192.168.11.215 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;192.168.50.0/24 dev vmbr1 scope link 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;root@ssd:/etc/network# 
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;OK ping 一下對面看能不能過&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;8
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;root@ssd:/etc/network# ping 192.168.50.10
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;PING 192.168.50.10 (192.168.50.10) 56(84) bytes of data.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;64 bytes from 192.168.50.10: icmp_seq=1 ttl=64 time=0.083 ms
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;64 bytes from 192.168.50.10: icmp_seq=2 ttl=64 time=0.067 ms
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;64 bytes from 192.168.50.10: icmp_seq=3 ttl=64 time=0.080 ms
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;64 bytes from 192.168.50.10: icmp_seq=4 ttl=64 time=0.126 ms
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;^C
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;--- 192.168.50.10 ping statistics ---
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;GOOD ！很好！通了一邊，另外一邊就照辦，兩邊都通了，就可以開始來測試速度了&lt;/p&gt;
&lt;p&gt;p.s 這個路由不知道需不需要每次都手動增加，或者是有哪個config可以在開機時載入&lt;/p&gt;
&lt;p&gt;沒記錯的話，應該是在 /etc/network/if-up.d/ 新增一個 route 檔案&lt;/p&gt;
&lt;p&gt;不過這部份我不是很確定就是了&lt;/p&gt;
&lt;p&gt;所以自己寫了一個 script 來用..&lt;/p&gt;
&lt;h3 id=&#34;strongiperf-測試速度strong&#34;&gt;&lt;!-- raw HTML omitted --&gt;iperf 測試速度&lt;!-- raw HTML omitted --&gt;&lt;/h3&gt;
&lt;p&gt;在linux 上，我習慣用 iperf 來測試兩台主機的連接速度&lt;/p&gt;
&lt;p&gt;兩邊都用 apt install iperf 裝好套件&lt;/p&gt;
&lt;p&gt;然後找一台作為 server ，執行&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;iperf -s
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;然後到另一台，去執行&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;9
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;2018-11-30 15:36:58 [minion@ubuntu ~]$ iperf -d -t 600 -P 10 -c 192.168.50.200
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;WARNING: option -d is not valid for server mode
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;------------------------------------------------------------
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Client connecting to 192.168.50.200, TCP port 5001
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;TCP window size: 85.0 KByte (default)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;------------------------------------------------------------
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;[  3] local 192.168.50.199 port 40980 connected with 192.168.50.200 port 5001
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;[ ID] Interval       Transfer     Bandwidth
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;[  3]  0.0-600.0 sec   641 GBytes  9.18 Gbits/sec
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;哈哈哈，有目有！測試速度來到了 9.18 Gbits 啊！ 就是一個爽啊！&lt;/p&gt;
&lt;p&gt;記得那個 server IP 是你 VM 裡面設定的 IP，不是 proxmox 上面的&lt;/p&gt;
&lt;p&gt;同場加映走 1Gb 網路的測試結果&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;9
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;2018-11-30 16:39:37 [minion@ubuntu ~]$ iperf -d -t 600 -P 10 -c 192.168.11.171
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;WARNING: option -d is not valid for server mode
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;------------------------------------------------------------
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Client connecting to 192.168.11.171, TCP port 5001
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;TCP window size: 85.0 KByte (default)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;------------------------------------------------------------
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;[  3] local 192.168.11.55 port 38582 connected with 192.168.11.171 port 5001
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;[ ID] Interval       Transfer     Bandwidth
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;[  3]  0.0-600.0 sec  65.8 GBytes   941 Mbits/sec
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;192.168.11.171 跟 192.168.50.200 是同一台機器，只是一個是10G網卡，一個是onboard的 1Gb 網卡&lt;/p&gt;
&lt;p&gt;速度果然是提高了十倍呀，果然就是一個爽啊！！&lt;/p&gt;
&lt;h3 id=&#34;strong實際開vm來測試看看strong&#34;&gt;&lt;!-- raw HTML omitted --&gt;實際開VM來測試看看&lt;!-- raw HTML omitted --&gt;&lt;/h3&gt;
&lt;p&gt;&lt;del&gt;上面的測試，是兩台PVE HOST之間的連線測試&lt;/del&gt;&lt;/p&gt;
&lt;p&gt;接下來，要實際測試在PVE中，建立新的VM，一台安裝FreeNAS 作為storage，另一台則是一般的client&lt;/p&gt;
&lt;p&gt;步驟簡單來說，就是在ssd 這台PVE 建立一個新的VM，然後安裝FREENAS，並且提供NFS/iscsi 給另一台PVE Host作為storage來源&lt;/p&gt;
&lt;p&gt;新增storage選NFS，填入必要資訊後，在這台主機上，建立一個新的VM，磁碟選擇剛剛連接的NFS&lt;/p&gt;
&lt;h5 id=&#34;strong要特別注意freenas的nfs-share的參數要改strong&#34;&gt;&lt;!-- raw HTML omitted --&gt;要特別注意，freenas的NFS Share的參數要改&lt;!-- raw HTML omitted --&gt;#####&lt;/h5&gt;
&lt;p&gt;在 mapuser/mapgroup這邊要改成 root/wheel 不然會有無法寫入的問題&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://i.imgur.com/Yn7qYdK.png&#34;
	
	
	
	loading=&#34;lazy&#34;
	
		alt=&#34;FREENAS NFS Sharing&#34;
	
	
&gt;&lt;/p&gt;
&lt;p&gt;安裝完之後，實際跑一下 dd 看看速度多少&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Last login: Mon Dec  3 03:10:54 2018
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;2018-12-03 03:15:03 [administrator@ubuntu ~]$ dd if=/dev/zero of=testfile bs=10240 count=1000000
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;1000000+0 records in
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;1000000+0 records out
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;10240000000 bytes (10 GB, 9.5 GiB) copied, 9.63458 s, 1.1 GB/s
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;2018-12-03 03:17:28 [administrator@ubuntu ~]$ dd if=/dev/zero of=testfile bs=20480 count=1000000
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;1000000+0 records in
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;1000000+0 records out
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;20480000000 bytes (20 GB, 19 GiB) copied, 16.0786 s, 1.3 GB/s
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;2018-12-03 03:17:50 [administrator@ubuntu ~]$ dd if=/dev/zero of=testfile bs=4096 count=1000000
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;1000000+0 records in
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;1000000+0 records out
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;4096000000 bytes (4.1 GB, 3.8 GiB) copied, 4.80629 s, 852 MB/s
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;2018-12-03 03:25:23 [administrator@ubuntu ~]$ 
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;可以看到不但大檔案速度都很快，就連小檔案(4096)居然也有852MB&lt;/p&gt;
&lt;p&gt;我底層也不過就是四顆 SATA3 sandisk 240G SSD 而已啊&lt;/p&gt;
&lt;p&gt;如果都換成PCI-E SSD ，嘿嘿&amp;hellip;(流口水&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;不過呢，這個也只是自己建的LAB玩玩看而已&lt;/p&gt;
&lt;p&gt;真的要放到 production 環境去，我也還沒啥把握 (畢竟都是中古、二手、退役的產品拼湊起來的)&lt;/p&gt;
&lt;p&gt;而且沒有10G Switch ，所以只能點對點連接&lt;/p&gt;
&lt;p&gt;說不定等到對岸的 10G Switch 開始大降價 (我覺得 8 port SFP+ / NTD $2000 左右我應該就會出手了)&lt;/p&gt;
&lt;p&gt;再來把10G 的環境弄完整一點！&lt;/p&gt;</description>
        </item>
        <item>
        <title>[筆記] 為了metabase 修改 firefox 開啟網頁時使用的預設語言 change the preferred language in firefox for metabase</title>
        <link>https://h.cowbay.org/p/%E7%AD%86%E8%A8%98-%E7%82%BA%E4%BA%86metabase-%E4%BF%AE%E6%94%B9-firefox-%E9%96%8B%E5%95%9F%E7%B6%B2%E9%A0%81%E6%99%82%E4%BD%BF%E7%94%A8%E7%9A%84%E9%A0%90%E8%A8%AD%E8%AA%9E%E8%A8%80-change-the-preferred-language-in-firefox-for-metabase/</link>
        <pubDate>Thu, 15 Nov 2018 11:06:28 +0800</pubDate>
        
        <guid>https://h.cowbay.org/p/%E7%AD%86%E8%A8%98-%E7%82%BA%E4%BA%86metabase-%E4%BF%AE%E6%94%B9-firefox-%E9%96%8B%E5%95%9F%E7%B6%B2%E9%A0%81%E6%99%82%E4%BD%BF%E7%94%A8%E7%9A%84%E9%A0%90%E8%A8%AD%E8%AA%9E%E8%A8%80-change-the-preferred-language-in-firefox-for-metabase/</guid>
        <description>&lt;p&gt;最近在測試metabase，記得幾個月前就有測試過&lt;/p&gt;
&lt;p&gt;但是當時的界面和現在的樣子差很多，看樣子改版還滿勤勞的&lt;/p&gt;
&lt;p&gt;所以這次改用docker來建立，根本五分鐘不到就建好了(挖鼻孔)&lt;/p&gt;
&lt;p&gt;不過呢，很討厭的是，一進去就發現語系採用的是簡體中文&lt;/p&gt;
&lt;p&gt;來看看這張圖
&lt;img src=&#34;https://i.imgur.com/oK6WmtJ.png&#34;
	
	
	
	loading=&#34;lazy&#34;
	
		alt=&#34;metabase的簡體中文界面&#34;
	
	
&gt;&lt;/p&gt;
&lt;p&gt;WHAT THE FUCK !!!&lt;/p&gt;
&lt;p&gt;這是哪一國的翻譯？？我相信對岸人才濟濟，絕對不至於翻譯出這種結果來..&lt;/p&gt;
&lt;p&gt;想當然爾，我認為這個問題可以暫時不管，反正進入系統後，再去使用者界面設定就好&lt;/p&gt;
&lt;p&gt;BUT .. (對，又是這個他X的BUT)&lt;/p&gt;
&lt;p&gt;使用者設置裡面根本沒什麼可以改！&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://i.imgur.com/DBRE5J6.png&#34;
	
	
	
	loading=&#34;lazy&#34;
	
		alt=&#34;metabase超陽春的使用者設置&#34;
	
	
&gt;&lt;/p&gt;
&lt;p&gt;對，沒錯，就只有這樣！！ 請容許我再罵一次 WHAT THE FUCK !!!&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;好吧，罵完就算了，還是要想辦法解決，於是切到管理界面，的確是有語言設置&lt;/p&gt;
&lt;p&gt;然後，我要再罵第三次 WHAT THE FUCK !!!&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://i.imgur.com/HCSf8Ba.png&#34;
	
	
	
	loading=&#34;lazy&#34;
	
		alt=&#34;metabase管理界面&#34;
	
	
&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;The default language for this Metabase instance.This only applies to emails, Pulses, etc. Users&amp;#39; browsers will specify the language used in the user interface.
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;簡單說，這邊的語言設定「不影響」使用者界面，界面使用的語系，由各個瀏覽器決定！&lt;/p&gt;
&lt;p&gt;好，那我去修改firefox 的語言看看&lt;/p&gt;
&lt;p&gt;開啟 firefox ，點選右上角的三橫槓，找到語言選項&lt;/p&gt;
&lt;p&gt;我一開始改成這樣&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://i.imgur.com/630BBJF.png&#34;
	
	
	
	loading=&#34;lazy&#34;
	
		alt=&#34;firefox settings&#34;
	
	
&gt;&lt;/p&gt;
&lt;p&gt;結果不管重開幾次，開啟metabase還是那個殘體中文字&lt;/p&gt;
&lt;p&gt;後來想說，啊，會不會是「英語」「美語」的差異？&lt;/p&gt;
&lt;p&gt;所以我把順序改成&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://i.imgur.com/pfdSWaC.png&#34;
	
	
	
	loading=&#34;lazy&#34;
	
		alt=&#34;firefox language settings for metabase&#34;
	
	
&gt;&lt;/p&gt;
&lt;p&gt;然後再開 metabase ，結果就如我所願的，改成英文界面了&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://i.imgur.com/rc6SLSC.png&#34;
	
	
	
	loading=&#34;lazy&#34;
	
		alt=&#34;metabase in English&#34;
	
	
&gt;&lt;/p&gt;
&lt;p&gt;真的是比殘體中文好太多了..&lt;/p&gt;
&lt;p&gt;另外，關於繁體中文的部份，也到metabase的官方論壇去留言了&lt;/p&gt;
&lt;p&gt;就看看官方要不要處理這個問題&amp;hellip;&lt;/p&gt;</description>
        </item>
        <item>
        <title>PostgreSQL 直接從已經存在的使用者複製權限到另一個使用者</title>
        <link>https://h.cowbay.org/p/postgresql-%E7%9B%B4%E6%8E%A5%E5%BE%9E%E5%B7%B2%E7%B6%93%E5%AD%98%E5%9C%A8%E7%9A%84%E4%BD%BF%E7%94%A8%E8%80%85%E8%A4%87%E8%A3%BD%E6%AC%8A%E9%99%90%E5%88%B0%E5%8F%A6%E4%B8%80%E5%80%8B%E4%BD%BF%E7%94%A8%E8%80%85/</link>
        <pubDate>Mon, 12 Nov 2018 09:48:12 +0800</pubDate>
        
        <guid>https://h.cowbay.org/p/postgresql-%E7%9B%B4%E6%8E%A5%E5%BE%9E%E5%B7%B2%E7%B6%93%E5%AD%98%E5%9C%A8%E7%9A%84%E4%BD%BF%E7%94%A8%E8%80%85%E8%A4%87%E8%A3%BD%E6%AC%8A%E9%99%90%E5%88%B0%E5%8F%A6%E4%B8%80%E5%80%8B%E4%BD%BF%E7%94%A8%E8%80%85/</guid>
        <description>&lt;p&gt;因為工作上的需求，有個資料庫需要開放給不同team的人去存取&lt;/p&gt;
&lt;p&gt;雖然都是在同一台機器上的同一個資料庫&lt;/p&gt;
&lt;p&gt;但是希望能夠不同team的人用不同的資料庫使用者&lt;/p&gt;
&lt;p&gt;這樣萬一出事，會比較好抓兇手？？&lt;/p&gt;
&lt;p&gt;總之呢，這個需求一直反覆出現&lt;/p&gt;
&lt;p&gt;每次開發不同的AP，就要求一個不同的代號，實在有點煩&lt;/p&gt;
&lt;p&gt;之前都是用pgadmin來處理，現在就改用psql來弄&lt;/p&gt;
&lt;p&gt;其實也很簡單&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;CREATE ROLE b LOGIN;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;GRANT a TO b;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;可以帶入script ，用script 或者用ansible去跑就好了&lt;/p&gt;
&lt;p&gt;省得每次都要在那邊手動改來改去..&lt;/p&gt;</description>
        </item>
        <item>
        <title>[筆記] 詭異的client&amp;server間連線的問題，或許跟KVM有關係？</title>
        <link>https://h.cowbay.org/p/%E7%AD%86%E8%A8%98-%E8%A9%AD%E7%95%B0%E7%9A%84clientserver%E9%96%93%E9%80%A3%E7%B7%9A%E7%9A%84%E5%95%8F%E9%A1%8C%E6%88%96%E8%A8%B1%E8%B7%9Fkvm%E6%9C%89%E9%97%9C%E4%BF%82/</link>
        <pubDate>Thu, 08 Nov 2018 18:01:23 +0800</pubDate>
        
        <guid>https://h.cowbay.org/p/%E7%AD%86%E8%A8%98-%E8%A9%AD%E7%95%B0%E7%9A%84clientserver%E9%96%93%E9%80%A3%E7%B7%9A%E7%9A%84%E5%95%8F%E9%A1%8C%E6%88%96%E8%A8%B1%E8%B7%9Fkvm%E6%9C%89%E9%97%9C%E4%BF%82/</guid>
        <description>&lt;p&gt;這是發生在一個夜黑風高的寂寥深夜&amp;hellip;.. ( What The FXXX &amp;hellip; )&lt;/p&gt;
&lt;p&gt;來到這個環境之後，有一個很詭異的狀況一直困擾著我&lt;/p&gt;
&lt;p&gt;在每個分公司，都會有一台伺服器作為KVM Host&lt;/p&gt;
&lt;p&gt;上面跑兩台VM，一台作為ansible controller (目前沒作用)&lt;/p&gt;
&lt;p&gt;另一台作為這邊所謂的 &amp;ldquo;Build Server&amp;rdquo;&lt;/p&gt;
&lt;p&gt;用途包含了DHCP Server / Proxy Server (squid3) / APT Proxy (squid-deb-proxy)&lt;/p&gt;
&lt;p&gt;問題就發生在這台 Build Server 上&amp;hellip;&lt;/p&gt;
&lt;p&gt;有陣子花了點時間去檢查各個分公司的網路環境，確保每一台Build Server都能夠連接Internet&lt;/p&gt;
&lt;p&gt;然後找了一個離總部最近的據點，把這些電腦連接Internet 的方式改為用 proxy 來控制&lt;/p&gt;
&lt;p&gt;在proxy內加入了 allowhost 的設定，然後把user電腦上的瀏覽器都代入 proxy server (firefox/chrome 的設定方式不同)&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;acl localnet src 192.168.28.0/24
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;acl allowhost src &amp;#34;/etc/squid3/allowhost.txt&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;acl localdomain dstdomain &amp;#34;/etc/squid3/localdomain.txt&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;acl SSL_ports port 443
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;acl Safe_ports port 80      # http                                                                                                                          
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;acl Safe_ports port 21      # ftp
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;acl Safe_ports port 443     # https
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;acl Safe_ports port 70      # gopher
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;acl Safe_ports port 210     # wais
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;acl Safe_ports port 1025-65535  # unregistered ports
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;acl Safe_ports port 280     # http-mgmt
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;acl Safe_ports port 488     # gss-http
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;acl Safe_ports port 591     # filemaker
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;acl Safe_ports port 777     # multiling http
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;acl CONNECT method CONNECT
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;一開始這樣作還相安無事，但是呢，慢慢的時不時會有USER反應說無法連接 Internet&lt;/p&gt;
&lt;p&gt;照理來說，因為都是透過proxy上網，所以如果是proxy server出問題，那其他電腦應該也不行上Internet&lt;/p&gt;
&lt;p&gt;但如果這樣的話，那就一點也不詭異了呀(攤手)&lt;/p&gt;
&lt;p&gt;實際上的狀況是，只有反應的USER的電腦無法連接Internet&lt;/p&gt;
&lt;p&gt;然後真的詭異的來了&lt;/p&gt;
&lt;p&gt;用USER電腦去 ping proxy server ，有時候會通，有時候不通..&lt;/p&gt;
&lt;p&gt;從Proxy Server去 ping USER電腦，也是類似的狀況&lt;/p&gt;
&lt;p&gt;可是我卻可以透過IPSEC VPN，分別SSH連接到這兩台機器上&lt;/p&gt;
&lt;p&gt;這代表兩台的網路都OK呀..&lt;/p&gt;
&lt;p&gt;正當我百思不得其解的時候，突然 USER電腦那邊的 ping 有反應了&lt;/p&gt;
&lt;p&gt;變成可以 ping proxy Server 了！ (What the FXXX !!!!)&lt;/p&gt;
&lt;p&gt;我什麼都沒改呀&amp;hellip;&lt;/p&gt;
&lt;p&gt;update: 2018/11/19&lt;/p&gt;
&lt;p&gt;剛剛在測試一台機器，又發生這個問題&lt;/p&gt;
&lt;p&gt;兩台都ping不到對方&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://i.imgur.com/gSD086o.png&#34;
	
	
	
	loading=&#34;lazy&#34;
	
		alt=&#34;ping不到&#34;
	
	
&gt;&lt;/p&gt;
&lt;p&gt;什麼事也沒做，就是把ping中斷，然後再ping 一次，居然就可以了&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://i.imgur.com/rvtw0hh.png&#34;
	
	
	
	loading=&#34;lazy&#34;
	
		alt=&#34;又ping到了&#34;
	
	
&gt;&lt;/p&gt;
&lt;p&gt;##真他X的詭異啊！&lt;/p&gt;
&lt;!-- raw HTML omitted --&gt;
&lt;p&gt;反正呢&amp;hellip;&lt;/p&gt;
&lt;p&gt;這種狀況三不五時就會出現一次，會出現在哪一台電腦也不一定&lt;/p&gt;
&lt;p&gt;不過，依照觀察到的狀況來說，似乎都是發生在很少開機的電腦上&lt;/p&gt;
&lt;p&gt;然後呢，因為底層是 KVM&lt;/p&gt;
&lt;p&gt;我也嘗試過用virsh 去restart VM 或者是 restart network&lt;/p&gt;
&lt;p&gt;有時候可以解決，有時候又還是不能連接&lt;/p&gt;
&lt;p&gt;於是另外測試安裝了 proxmox VE 的虛擬平台&lt;/p&gt;
&lt;p&gt;在上面起一台新的Server，再用 ansible 做成 build server的角色&lt;/p&gt;
&lt;p&gt;這樣子作的機器，就不會發生這種狀況&lt;/p&gt;
&lt;p&gt;所以我在猜是不是跟底層是KVM有關係..&lt;/p&gt;
&lt;p&gt;不過要動這個的話，工程有點大，手邊也沒那麼多機器可以替換(很慘)&lt;/p&gt;
&lt;p&gt;暫時先保留這個作法，等到下次再發生這狀況&lt;/p&gt;
&lt;p&gt;再來找老闆看這情形，然後來討論要不要換掉各分公司的VM Host&amp;hellip;&lt;/p&gt;</description>
        </item>
        <item>
        <title>筆記- 啟用群暉NAS (Synology NAS)的SSH Server  透過Publickey 認證免密碼登入</title>
        <link>https://h.cowbay.org/p/%E7%AD%86%E8%A8%98-%E5%95%9F%E7%94%A8%E7%BE%A4%E6%9A%89nas-synology-nas%E7%9A%84ssh-server-%E9%80%8F%E9%81%8Epublickey-%E8%AA%8D%E8%AD%89%E5%85%8D%E5%AF%86%E7%A2%BC%E7%99%BB%E5%85%A5/</link>
        <pubDate>Mon, 05 Nov 2018 14:16:54 +0800</pubDate>
        
        <guid>https://h.cowbay.org/p/%E7%AD%86%E8%A8%98-%E5%95%9F%E7%94%A8%E7%BE%A4%E6%9A%89nas-synology-nas%E7%9A%84ssh-server-%E9%80%8F%E9%81%8Epublickey-%E8%AA%8D%E8%AD%89%E5%85%8D%E5%AF%86%E7%A2%BC%E7%99%BB%E5%85%A5/</guid>
        <description>&lt;p&gt;公司內有幾台NAS，其中有一台用來放開發人員的postgresql dump file
之前都是主要的開發人員上傳到google drive，分享出來 ，然後其他人去抓回來&lt;/p&gt;
&lt;p&gt;這樣子有個問題是，當server要存取這些檔案時，就沒辦法了，除非透過一些 3rd party的軟體
像是這篇&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://www.omgubuntu.co.uk/2017/04/mount-google-drive-ocamlfuse-linux&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://www.omgubuntu.co.uk/2017/04/mount-google-drive-ocamlfuse-linux&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;或者是這篇&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://www.maketecheasier.com/mount-google-drive-ubuntu/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://www.maketecheasier.com/mount-google-drive-ubuntu/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;但是手邊的伺服器，原則上除非有必要，不然都沒有開放internet
所以導致明明檔案就在那邊，但是要取得就是很麻煩&lt;/p&gt;
&lt;p&gt;Dev_A upload to google drive &amp;mdash;&amp;gt; Dev_B Download from google drive &amp;mdash;&amp;gt; Dev_B scp download file to me &amp;mdash;&amp;gt; I upload to server.&lt;/p&gt;
&lt;p&gt;有沒有？是不是很stupid (講話一定要烙英文)&lt;/p&gt;
&lt;p&gt;既然有現成的NAS在那邊，幹嘛不用呢？(攤手)&lt;/p&gt;
&lt;p&gt;聽說之前的人一直沒成功弄出來，讓Server可以直接去NAS存取檔案的方式，我記得這個不是很難啊
就順手整理一下&lt;/p&gt;
&lt;h3 id=&#34;新增使用者帳號-確認家目錄存在&#34;&gt;新增使用者帳號/ 確認家目錄存在&lt;/h3&gt;
&lt;p&gt;在NAS 的管理界面上新增一個帳號，假設叫 eric 好了&lt;/p&gt;
&lt;p&gt;&lt;del&gt;建立時，注意一下要指定家目錄路徑&lt;/del&gt;&lt;/p&gt;
&lt;p&gt;更正： 群暉的界面好像不能指定家目錄&lt;/p&gt;
&lt;p&gt;預設的路徑如下&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;eric:x:1071:100::/var/services/homes/eric:/sbin/nologin
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;不過我覺得怪怪的，因為在我手邊的幾台NAS底下 /var/services/homes 都切不過去
確認一下路徑，發現那個 &lt;code&gt;@fake_home_link&lt;/code&gt; 根本就不存在啊！&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;admin@storage:/volume1$ ls -lart /var/services/homes 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;lrwxrwxrwx 1 root root 24 May 23 14:14 /var/services/homes -&amp;gt; /volume1/@fake_home_link
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;admin@storage:/volume1$
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;我在想是不是之前的人有改過什麼..
anyway ，反正先不管這邊，直接修改 /etc/passwd檔案&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sudo vim /etc/passwd
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;修正到正確的路徑，順便把shell 也改掉，不然不能登入&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;eric:x:1071:100::/volume1/homes/eric:/bin/sh
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h3 id=&#34;修改-etcsshsshd_config&#34;&gt;修改 /etc/ssh/sshd_config&lt;/h3&gt;
&lt;p&gt;再來修正預設沒有啟用 Publickey 驗證的 ssh&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sudo vim /etc/ssh/sshd_config
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;確認底下三行存在&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;RSAAuthentication yes
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;PubkeyAuthentication yes
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;AuthorizedKeysFile	.ssh/authorized_keys
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h3 id=&#34;將key傳到-nas上&#34;&gt;將KEY傳到 NAS上&lt;/h3&gt;
&lt;p&gt;先建立相關目錄，順便修正一下目錄權限&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;chmod 755 /volume1/homes/eric
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;mkdir -p /volume1/homes/eric/.ssh
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;chmod 700 /volume1/homes/eric/.ssh
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;再來把Publickey 傳到NAS，複製貼上也好，ssh-copy-id也可以，同時修正權限&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;vim /volume1/homes/eric/.ssh/authorized_keys 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;chmod 0600 /volume1/eric/.ssh/authorized_keys
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h3 id=&#34;重啟ssh&#34;&gt;重啟SSH&lt;/h3&gt;
&lt;p&gt;本來這個步驟應該可以用&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;synoservicectl --restart sshd
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;來解決
但是實際上這個指令只會把你踢出 SSH session &amp;hellip;.( WTF!!! )&lt;/p&gt;
&lt;p&gt;所以還是要去NAS的管理界面，去關閉再打開SSH (有點蠢..)
&lt;img src=&#34;https://i.imgur.com/jcDQmI1.png&#34;
	
	
	
	loading=&#34;lazy&#34;
	
		alt=&#34;Synology WEB UI&#34;
	
	
&gt;&lt;/p&gt;
&lt;p&gt;然後就可以測試用Publickey 來登入NAS了&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;2018-11-05 14:47:12 [mini@s009 ansiblecontrol]$ ssh admin@storage 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;admin@storage:~$ 
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;確認免密碼登入無誤了！&lt;/p&gt;</description>
        </item>
        
    </channel>
</rss>
